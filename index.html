<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>チャージ料金計算（5400円ルール版）</title>
<style>
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN";padding:18px}
  label,input,select,button{display:block;margin:8px 0;font-size:16px}
  .result{margin-top:12px;font-weight:bold}
  pre{background:#f6f6f6;padding:8px;border-radius:6px}
</style>
</head>
<body>
  <h2>チャージ料金計算</h2>

  <label>性別
    <select id="gender">
      <option value="male">男性</option>
      <option value="female">女性</option>
    </select>
  </label>

  <label>入店時間
    <input type="time" id="startTime">
  </label>

  <label>退店時間
    <input type="time" id="endTime">
  </label>

  <button onclick="calculate()">計算する</button>

  <div class="result" id="result">料金: - 円</div>
  <pre id="breakdown"></pre>

<script>
function getRates(gender, isBar) {
  if (gender === "male") {
    return isBar ? { first30:500, add15:400 } : { first30:400, add15:300 };
  } else {
    return isBar ? { first30:500, add15:300 } : { first30:400, add15:200 };
  }
}

function parseTimeToDate(t) {
  return new Date("2000-01-01T" + t + ":00");
}

function calculate() {
  const gender = document.getElementById("gender").value;
  const startStr = document.getElementById("startTime").value;
  const endStr = document.getElementById("endTime").value;
  const out = document.getElementById("result");
  const bd = document.getElementById("breakdown");

  if (!startStr || !endStr) {
    alert("入店時間と退店時間を入力してください");
    return;
  }

  let startDate = parseTimeToDate(startStr);
  let endDate = parseTimeToDate(endStr);
  if (endDate <= startDate) endDate.setDate(endDate.getDate() + 1); // 日跨ぎ対応

  // 最初の30分
  const initialIsBar = startDate.getHours() >= 22;
  const rates = getRates(gender, initialIsBar);
  let total = rates.first30;
  let breakdown = [];
  breakdown.push(`初回30分（${initialIsBar ? "バー" : "カフェ"}）: ${rates.first30}円`);

  const after30 = new Date(startDate.getTime() + 30*60000);

  // 以降は15分ごとに判定
  let blockStart = new Date(after30);
  while (blockStart < endDate) {
    let isBar = blockStart.getHours() >= 22;
    const rate = getRates(gender, isBar).add15;
    total += rate;
    breakdown.push(`${blockStart.getHours().toString().padStart(2,"0")}:${blockStart.getMinutes().toString().padStart(2,"0")}〜 (${isBar ? "バー" : "カフェ"}) ${rate}円`);
    blockStart = new Date(blockStart.getTime() + 15*60000);
  }

  out.innerText = `料金: ${total} 円`;
  bd.innerText = breakdown.join("\n");
}
</script>
</body>
</html>
